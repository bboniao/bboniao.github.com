
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Eveyday is Happy! - My Blog</title>
    
    <meta name="keywords" content="">
    <meta name="author" content="bboniao">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->

    <link href="/assets/themes/havee/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/havee/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/themes/havee/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/havee/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/havee/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" media="all" />

    <link rel="shortcut icon" href="/favicon.png">
    <link rel="canonical" href="http://bboniao.com/" />
    <!-- fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.png">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="My Blog ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="My Blog RSS Feed">

    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b5d769f7d7e07e37cf190177dd2ee2a1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </head>

  <body>
    <!--[if lte IE 8]>
      <div class="alert alert-warning">
        <p>Your Internet Explorer is not supported. Please upgrade your Internet Explorer to version 9+, or use latest <a href="http://www.google.com/chrome/" target="_blank" class="alert-link">Google chrome</a>、<a href="http://www.mozilla.org/firefox/" target="_blank" class="alert-link">Mozilla Firefox</a>.</p>
        <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-us/internet-explorer/use-compatibility-view#ie=ie-8" target="_blank" class="alert-link">turn off "Compatibility view"</a>.</p>
      </div>
    <![endif]-->

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/" title="My Blog">My Blog</a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav">
          
          
          


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



          <li>
            <form id="search-form" class="form-inline visible-lg" role="form">
              <input type="text" class="form-control input-sm" placeholder="Search" id="query">
            </form>
          </li>
        </ul>

        <ul class="nav navbar-nav navbar-right visible-lg visible-md">
          <li><a href="/rss.xml" target="_blank" title="RSS"><span class="fa fa-rss fa-lg"></span></a></li>
          
            <li><a href="https://github.com/bboniao" target="_blank" title="Github"><span class="fa fa-github fa-lg"></span></a></li>
          
          
          
          
          
            <li><a href="http://weibo.com/bboniao" target="_blank" title="Weibo"><span class="fa fa-weibo fa-lg"></span></a></li>
          
        </ul>
      </div><!-- /.navbar-collapse -->
      </div>
    </nav>

    <div class="container">
      <div class="content">
        
<div class="row">

  <div class="col-md-9 main-contenter">
    <div id="search-loader" style="display:none;text-align:center">
      <img src="/assets/themes/havee/images/loading.gif">
    </div>
    <div class="page-header-wrapper">
      <div class="page-header">
        <h2>Eveyday is Happy!  <small>Home Page</small></h2>
      </div>
    </div>
    <article>


<div class="wrapper">
  <h2 class="h2 entry-title"><a href="/hbase/2014-04/hbasecolumncolumnput.html">HBase在单Column和多Column情况下批量Put的性能对比分析</a></h2>
  
    <h3>转自<a href="http://blog.linezing.com/?p=2106">量子恒道官方博客</a></h3>

<p>针对HBase在单column family单column qualifier和单column family多column qualifier两种场景下，分别批量Put写入时的性能对比情况，下面是结合HBase的源码来简单分析解释这一现象。</p>

<h3>1. 测试结果</h3>

<p>在客户端批量写入时，单列族单列模式和单列族多列模式的TPS和RPC次数相差很大，以客户端10个线程，开启WAL的两种模式下的测试数据为例，</p>

<h5>1)单列族单列模式下，TPS能够达到12403.87，实际RPC次数为53次；</h5>

<h5>2)单列族多列模式下，TPS只有1730.68，实际RPC次数为478次。</h5>

<p>二者TPS相差约7倍，RPC次数相差约9倍。详细的测试环境这里不再罗列，我们这里关心的只是在两种条件下的性能差别情况。</p>


  

  <div class="status">
    <div class="col-md-6 date visible-lg visible-md">
      <span class="glyphicon glyphicon-time"></span> 16 Apr 2014
      <span class="glyphicon glyphicon-comment"></span><a href="/hbase/2014-04/hbasecolumncolumnput.html#comments"> Comments</a>
    </div>
    
    <a class="btn btn-default btn-sm pull-right" href="/hbase/2014-04/hbasecolumncolumnput.html"><span class="readmore">Read More &raquo; </span></a>
    
    <div class="clearfix"></div>
  </div>
</div>

<div class="wrapper">
  <h2 class="h2 entry-title"><a href="/hbase/2014-04/hbase-delete-put.html">hbase delete put的陷阱</a></h2>
  
    <h3>问题</h3>

<p>删除数据之后,再插入,查询的时候怎么也找不到.删除和插入都是同一个rowkey,同一个列,同一个版本.</p>

<h3>原因</h3>

<p>如果rowkey/family/qulifier/timestamp都一样,多次删除和插入之后,获取哪个值取决于KeyValue.Type.Put之前是Delete就不会被插入了.</p>


  

  <div class="status">
    <div class="col-md-6 date visible-lg visible-md">
      <span class="glyphicon glyphicon-time"></span> 16 Apr 2014
      <span class="glyphicon glyphicon-comment"></span><a href="/hbase/2014-04/hbase-delete-put.html#comments"> Comments</a>
    </div>
    
    <a class="btn btn-default btn-sm pull-right" href="/hbase/2014-04/hbase-delete-put.html"><span class="readmore">Read More &raquo; </span></a>
    
    <div class="clearfix"></div>
  </div>
</div>

<div class="wrapper">
  <h2 class="h2 entry-title"><a href="/hbase/2014-04/hbase-cloumnfamily.html">为什么要控制hbase cloumnFamily的数量</a></h2>
  
    <p>设计Hbase schema,要尽量使用一个column family.原因主要是flush和compact机制造成的.</p>

<p>flush和compact都是基于region级别的:当一个column family数据导入过多,发生flush,也会触发其他所有column family的(此时很小的memstore也会被触发的).而flush会生成很多storefile,紧接着就会触发compact.过多没必要的flush/compact会大大增加io的开销,影响hbase整体性能.</p>


  

  <div class="status">
    <div class="col-md-6 date visible-lg visible-md">
      <span class="glyphicon glyphicon-time"></span> 16 Apr 2014
      <span class="glyphicon glyphicon-comment"></span><a href="/hbase/2014-04/hbase-cloumnfamily.html#comments"> Comments</a>
    </div>
    
    <a class="btn btn-default btn-sm pull-right" href="/hbase/2014-04/hbase-cloumnfamily.html"><span class="readmore">Read More &raquo; </span></a>
    
    <div class="clearfix"></div>
  </div>
</div>

<div class="wrapper">
  <h2 class="h2 entry-title"><a href="/memcache/2014-04/memcachehash.html">memcache使用一致性hash,找出指向的节点</a></h2>
  
    <h3>代码如下</h3>
<div class="highlight"><pre><code class="text language-text" data-lang="text">//地址列表
String[] array = addrs.split(&quot;;&quot;);
List&lt;InetSocketAddress&gt; isa = new ArrayList&lt;InetSocketAddress&gt;();
for(int i = 0;i &lt; array.length;i ++){
    String[] addr = array[i].split(&quot;:&quot;);
    isa.add(new InetSocketAddress(addr[0], Integer.parseInt(addr[1])));
}
MemcachedClientBuilder builder = new XMemcachedClientBuilder(isa);
//一致性hash
builder.setSessionLocator(new KetamaMemcachedSessionLocator());
builder.setOpTimeout(200);

builder.build();
String memcacheKey = &quot;test&quot;;
InetSocketAddress i = builder.getSessionLocator().getSessionByKey(memcacheKey).getRemoteSocketAddress();
System.out.println(i.getHostString());
System.out.println(i.getPort());
</code></pre></div>

  

  <div class="status">
    <div class="col-md-6 date visible-lg visible-md">
      <span class="glyphicon glyphicon-time"></span> 14 Apr 2014
      <span class="glyphicon glyphicon-comment"></span><a href="/memcache/2014-04/memcachehash.html#comments"> Comments</a>
    </div>
    
    <a class="btn btn-default btn-sm pull-right" href="/memcache/2014-04/memcachehash.html"><span class="readmore">Read More &raquo; </span></a>
    
    <div class="clearfix"></div>
  </div>
</div>

<div class="wrapper">
  <h2 class="h2 entry-title"><a href="/java/2014-04/a-better-log4j-smtpappender.html">A Better Log4j SMTPAppender</a></h2>
  
    <h3>log4j配置mail发送log,会有多少发多少,如下改动可以在指定时间内发送指定次数的log</h3>

<h3>java代码</h3>
<div class="highlight"><pre><code class="text language-text" data-lang="text">package com.sohu.rc.util;
import org.apache.log4j.net.SMTPAppender;
public class LimitedSMTPAppender extends SMTPAppender {
    private int limit = 10; // max at 10 mails ...
    private int cycleSeconds = 3600; // ... per hour
    public void setLimit(int limit) {
        this.limit = limit;
    }
    public void setCycleSeconds(int cycleSeconds) {
        this.cycleSeconds = cycleSeconds;
    }
    private int lastVisited;
    private long lastCycle;
    @Override
    protected boolean checkEntryConditions() {
        final long now = System.currentTimeMillis();
        final long thisCycle = now - (now % (1000L * cycleSeconds));
        if (lastCycle != thisCycle) {
            lastCycle = thisCycle;
            lastVisited = 0;
        }
        lastVisited++;
        return super.checkEntryConditions() &amp;&amp; lastVisited &lt;= limit;
    }
}
</code></pre></div>

  

  <div class="status">
    <div class="col-md-6 date visible-lg visible-md">
      <span class="glyphicon glyphicon-time"></span> 12 Apr 2014
      <span class="glyphicon glyphicon-comment"></span><a href="/java/2014-04/a-better-log4j-smtpappender.html#comments"> Comments</a>
    </div>
    
    <a class="btn btn-default btn-sm pull-right" href="/java/2014-04/a-better-log4j-smtpappender.html"><span class="readmore">Read More &raquo; </span></a>
    
    <div class="clearfix"></div>
  </div>
</div>


<!-- Pagination links -->
<div class="pull-right">
  
    <span><a class="btn btn-default btn-sm disabled" href="/">Home</a></span>
    <span><a class="btn btn-default btn-sm disabled">&laquo; Prev</a></span>
  
  <span><a class="btn btn-default btn-sm disabled">Page: 1 of 4</a></span>
  
    <a class="btn btn-default btn-sm" href="/page2/">Next &raquo;</a>
    <a class="btn btn-default btn-sm" href="/page4/">Last</a>
  
</div>



</article>
  </div>

  <div class="col-md-3 visible-lg visible-md">
                <section>
        <h4>Categories</h4>
        <div class="tag_box">
          <ul>
          
          


  
     
    	<li><a href="/categories.html#jvm-ref">
    		jvm <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#tools-ref">
    		tools <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#jekyll-ref">
    		jekyll <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#linux-ref">
    		linux <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#hadoop-ref">
    		hadoop <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#java-ref">
    		java <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#memcache-ref">
    		memcache <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#hbase-ref">
    		hbase <span>3</span>
    	</a></li>
    
  

 
          </ul>
        </div>
      </section>


            <section>
       <h4>Recently Posts</h4>
       <div class="category">
         <ul>
           
           <li><a href="/hbase/2014-04/hbasecolumncolumnput.html">HBase在单Column和多Column情况下批量Put的性能对比分析</a></li>
           
           <li><a href="/hbase/2014-04/hbase-delete-put.html">hbase delete put的陷阱</a></li>
           
           <li><a href="/hbase/2014-04/hbase-cloumnfamily.html">为什么要控制hbase cloumnFamily的数量</a></li>
           
           <li><a href="/memcache/2014-04/memcachehash.html">memcache使用一致性hash,找出指向的节点</a></li>
           
           <li><a href="/java/2014-04/a-better-log4j-smtpappender.html">A Better Log4j SMTPAppender</a></li>
           
           <li><a href="/linux/2014-04/kill-zombie-process.html">Kill Zombie Process</a></li>
           
           <li><a href="/java/2014-03/resin-load.html">记录一次resin load过高的解决过程</a></li>
           
           <li><a href="/java/2014-03/jmeter.html">jmeter使用</a></li>
           
           <li><a href="/hadoop/2014-03/hadoop2hbase096.html">hadoop2和hbase0.96的配置</a></li>
           
           <li><a href="/hadoop/2014-03/hadoop2-compile.html">hadoop2 compile</a></li>
           
         </ul>
       </div>
      </section>


            <section>
        <h4>Recently Comments</h4>
        <div class="category">
          <ul class="ds-recent-comments" data-num-items="10" data-show-avatars="0" data-show-time="0" data-show-title="0" data-show-admin="0" data-excerpt-length="12"></ul>
        </div>
      </section>


            <section>
        <h4>Recently Visitors</h4>
          <ul class="ds-recent-visitors" data-num-items="12" data-avatar-size="45" style="margin-top:10px;"></ul>
      </section>




  </div>

</div>


      </div>

      <footer class="text-left">
			<p>&copy; 2014 <a href="/" target="_blank">bboniao</a>. with Help from <a href="http://jekyllbootstrap.com/" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a> and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a></p>
      </footer>
    </div> <!-- /container -->

  <div id="back-top">
    <a href="#top" title="Back Top" class="visible-lg visible-md"></a>
  </div>

    <script src="/assets/themes/havee/js/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/havee/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/havee/js/bootstrap.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/havee/js/bootstrap.min.js"><\/script>')</script>
    <script type="text/javascript" src="/assets/themes/havee/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
    <script type="text/javascript" src="/assets/themes/havee/js/webcore.js"></script>

        <!--多说js加载开始，一个页面只需要加载一次 -->
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"bboniao"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = '/assets/themes/havee/js/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script>
    <!--多说js加载结束，一个页面只需要加载一次 -->
    



  </body>
</html>

