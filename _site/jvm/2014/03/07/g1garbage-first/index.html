
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>G1(Garbage First)的使用</title>
    <meta name="description" content="">
    <meta name="author" content="bboniao">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">My Blog</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>G1(Garbage First)的使用 </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>07 March 2014</span>
    </div>
    <div class="content">
      <h3>为什么采用G1</h3>

<p>Hbase开启SLAB之后还是会产生很多碎片,导致Full GC.原因是BlockCache产生很多碎片</p>

<h3>我的参数配置</h3>

<pre><code>-Xmx24g -Xms24g -XX:PermSize=96m -XX:MaxPermSize=96m -XX:+UseG1GC -XX:SurvivorRatio=6 -XX:MaxGCPauseMillis=400 -XX:G1ReservePercent=15  -XX:InitiatingHeapOccupancyPercent=40 -XX:ConcGCThreads=8
</code></pre>

<h3>G1常用参数</h3>

<table>
<thead>
<tr>
<th style="text-align:left;">参数</th>
<th style="text-align:left;">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">-XX:+UseG1GC</td>
<td style="text-align:left;">开启G1</td>
</tr>
<tr>
<td style="text-align:left;">-XX:MaxGCPauseMillis=n</td>
<td style="text-align:left;">设置GC暂停的最大时间,这只是目标,尽量达到,默认值是 200 毫秒,<code>过小影响吞吐量</code></td>
</tr>
<tr>
<td style="text-align:left;">-XX:InitiatingHeapOccupancyPercent=n</td>
<td style="text-align:left;">整个堆(而不是某个年代)使用量达到此值,便会触发并发GC周期.值为0则是连续触发,默认值为45</td>
</tr>
<tr>
<td style="text-align:left;">-XX:NewRatio=n</td>
<td style="text-align:left;">老年代与新生代的比值,默认值为2</td>
</tr>
<tr>
<td style="text-align:left;">-XX:SurvivorRatio=n</td>
<td style="text-align:left;">伊甸园代与生存代的比率,默认值为8</td>
</tr>
<tr>
<td style="text-align:left;">-XX:MaxTenuringThreshold=n</td>
<td style="text-align:left;">生存代存活的最大门限,默认值为15</td>
</tr>
<tr>
<td style="text-align:left;">-XX:ParallelGCThreads=n</td>
<td style="text-align:left;">设置垃圾回收器并行阶段的线程数,默认值与JVM运行的平台有关,<code>将 n 的值设置为逻辑处理器的数量</code></td>
</tr>
<tr>
<td style="text-align:left;">-XX:ConcGCThreads=n</td>
<td style="text-align:left;">设置并发垃圾回收器使用的线程数,默认值与JVM运行的平台有关</td>
</tr>
<tr>
<td style="text-align:left;">-XX:G1ReservePercent=n</td>
<td style="text-align:left;">设置剩余的内存量,减少跃迁失败的可能,默认值为10</td>
</tr>
<tr>
<td style="text-align:left;">-XX:G1HeapRegionSize=n</td>
<td style="text-align:left;">设置G1平分java堆而产生区域的大小,默认值可以提供最大的工效性.最小值为1M,最大为32M,最多划分1024个,<code>建议使用默认值</code></td>
</tr>
</tbody>
</table>


<h3>标记周期的各个阶段</h3>

<ol>
<li><strong>初始标记阶段：</strong>在此阶段，G1 GC 对根进行标记。该阶段与常规的 (<code>STW</code>) 年轻代垃圾回收密切相关。</li>
<li><strong>根区域扫描阶段：</strong>G1 GC 在初始标记的存活区扫描对老年代的引用，并标记被引用的对象。该阶段与应用程序（<code>非STW</code>）同时运行，并且只有完成该阶段后，才能开始下一次 <code>STW</code> 年轻代垃圾回收。</li>
<li><strong>并发标记阶段：</strong>G1 GC 在整个堆中查找可访问的（存活的）对象。该阶段与应用程序同时运行，可以被 <code>STW</code> 年轻代垃圾回收中断。</li>
<li><strong>重新标记阶段：</strong>该阶段是 <code>STW</code> 回收，帮助完成标记周期。G1 GC 清空 SATB 缓冲区，跟踪未被访问的存活对象，并执行引用处理。</li>
<li><strong>清理阶段：</strong>在这个最后阶段，G1 GC 执行统计和 RSet 净化的 <code>STW</code> 操作。在统计期间，G1 GC 会识别完全空闲的区域和可供进行混合垃圾回收的区域。清理阶段在将空白区域重置并返回到空闲列表时为部分并发。</li>
</ol>


<h3>内存用尽造成Full GC</h3>

<p>查找<code>to-space exhausted</code>和<code>to-space overflow</code>,标示因内存不够产生Full GC</p>

<ol>
<li>-XX:G1ReservePercent 增加预存内存量</li>
<li>-XX:InitiatingHeapOccupancyPercent 减少此值,提前启动标记周期</li>
<li>-XX:ConcGCThreads 增加并行标记线程的数目</li>
</ol>


    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#jvm-ref">
    		jvm <span>1</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#g1-ref">g1 <span>1</span></a></li>
     
    	<li><a href="/tags.html#gc-ref">gc <span>1</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev disabled"><a>&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/tools/2014/03/07/tools" title="常用工具包收集">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    




  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2014 bboniao
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

