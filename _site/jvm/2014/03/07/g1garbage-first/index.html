
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>G1(Garbage First)的使用 - My Blog</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="bboniao">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->

    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/themes/havee/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/havee/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/havee/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" media="all" />

    <link rel="shortcut icon" href="/favicon.png">
    <link rel="canonical" href="http://bboniao.com/jvm/2014/03/07/g1garbage-first" />
    <!-- fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.png">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="My Blog ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="My Blog RSS Feed">

    

</head>

<body>
<!--[if lte IE 8]>
<div class="alert alert-warning">
    <p>Your Internet Explorer is not supported. Please upgrade your Internet Explorer to version 9+, or use latest <a href="http://www.google.com/chrome/" target="_blank" class="alert-link">Google chrome</a>、<a href="http://www.mozilla.org/firefox/" target="_blank" class="alert-link">Mozilla Firefox</a>.</p>
    <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-us/internet-explorer/use-compatibility-view#ie=ie-8" target="_blank" class="alert-link">turn off "Compatibility view"</a>.</p>
</div>
<![endif]-->

<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/" title="My Blog">My Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                
                


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



                <li><a href="/vimwiki" target="_blank" title="Vimwiki">Vimwiki</a><li>
                <li>
                    <form id="search-form" class="form-inline visible-lg" role="form">
                        <input type="text" class="form-control input-sm" placeholder="Search" id="query">
                    </form>
                </li>
            </ul>

            <ul class="nav navbar-nav navbar-right visible-lg visible-md">
                <li><a href="/rss.xml" target="_blank" title="RSS"><span class="fa fa-rss fa-lg"></span></a></li>
                
                <li><a href="https://github.com/bboniao" target="_blank" title="Github"><span class="fa fa-github fa-lg"></span></a></li>
                
                
                
                <li><a href="https://twitter.com/bboniao" target="_blank" title="twitter"><span class="fa fa-twitter fa-lg"></span></a></li>
                
                
                
            </ul>
        </div><!-- /.navbar-collapse -->
    </div>
</nav>

<div class="container">
    <div class="content">
        
<div class="row">

  <div class="col-md-9 main-contenter">
    <div id="search-loader" style="display:none;text-align:center">
      <img src="/assets/themes/havee/images/loading.gif">
    </div>
    <div class="page-header">
      <h2>
        G1(Garbage First)的使用 
        
      </h2>
    </div>
    <article><h3>为什么采用G1</h3>

<p>Hbase开启SLAB之后还是会产生很多碎片,导致Full GC.原因是BlockCache产生很多碎片,CMS对碎片无能为力.采用G1吞吐量与CMS相当</p>

<h3>我的参数配置</h3>

<pre><code>-Xmx24g -Xms24g -XX:PermSize=96m -XX:MaxPermSize=96m -XX:+UseG1GC -XX:SurvivorRatio=6 -XX:MaxGCPauseMillis=400 -XX:G1ReservePercent=15  -XX:InitiatingHeapOccupancyPercent=40 -XX:ConcGCThreads=8
</code></pre>

<ol>
<li>新生代和region大小没有指定,G1可以更好的自动分配资源.</li>
<li>提高MaxGCPauseMillis,实时性要求没有太严格,可以提高吞吐量</li>
<li>提高G1ReservePercent,降低InitiatingHeapOccupancyPercent,提高ConcGCThreads因为遇到内存不足而产生了Full GC</li>
</ol>


<!-- more -->


<h3>G1常用参数</h3>

<table>
<thead>
<tr>
<th style="text-align:left;">参数</th>
<th style="text-align:left;">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">-XX:+UseG1GC</td>
<td style="text-align:left;">开启G1</td>
</tr>
<tr>
<td style="text-align:left;">-XX:MaxGCPauseMillis=n</td>
<td style="text-align:left;">设置GC暂停的最大时间,这只是目标,尽量达到,默认值是 200 毫秒,<code>过小影响吞吐量</code></td>
</tr>
<tr>
<td style="text-align:left;">-XX:InitiatingHeapOccupancyPercent=n</td>
<td style="text-align:left;">整个堆(而不是某个年代)使用量达到此值,便会触发并发GC周期.值为0则是连续触发,默认值为45</td>
</tr>
<tr>
<td style="text-align:left;">-XX:NewRatio=n</td>
<td style="text-align:left;">老年代与新生代的比值,默认值为2</td>
</tr>
<tr>
<td style="text-align:left;">-XX:SurvivorRatio=n</td>
<td style="text-align:left;">伊甸园代与生存代的比率,默认值为8</td>
</tr>
<tr>
<td style="text-align:left;">-XX:MaxTenuringThreshold=n</td>
<td style="text-align:left;">生存代存活的最大门限,默认值为15</td>
</tr>
<tr>
<td style="text-align:left;">-XX:ParallelGCThreads=n</td>
<td style="text-align:left;">设置垃圾回收器并行阶段的线程数,默认值与JVM运行的平台有关,<code>将 n 的值设置为逻辑处理器的数量</code></td>
</tr>
<tr>
<td style="text-align:left;">-XX:ConcGCThreads=n</td>
<td style="text-align:left;">设置并发垃圾回收器使用的线程数,默认值与JVM运行的平台有关</td>
</tr>
<tr>
<td style="text-align:left;">-XX:G1ReservePercent=n</td>
<td style="text-align:left;">设置剩余的内存量,减少跃迁失败的可能,默认值为10</td>
</tr>
<tr>
<td style="text-align:left;">-XX:G1HeapRegionSize=n</td>
<td style="text-align:left;">设置G1平分java堆而产生区域的大小,默认值可以提供最大的工效性.最小值为1M,最大为32M,最多划分1024个,<code>建议使用默认值</code></td>
</tr>
</tbody>
</table>


<h3>标记周期的各个阶段</h3>

<ol>
<li><strong>初始标记阶段：</strong>在此阶段，G1 GC 对根进行标记。该阶段与常规的 (<code>STW</code>) 年轻代垃圾回收密切相关。</li>
<li><strong>根区域扫描阶段：</strong>G1 GC 在初始标记的存活区扫描对老年代的引用，并标记被引用的对象。该阶段与应用程序（<code>非STW</code>）同时运行，并且只有完成该阶段后，才能开始下一次 <code>STW</code> 年轻代垃圾回收。</li>
<li><strong>并发标记阶段：</strong>G1 GC 在整个堆中查找可访问的（存活的）对象。该阶段与应用程序同时运行，可以被 <code>STW</code> 年轻代垃圾回收中断。</li>
<li><strong>重新标记阶段：</strong>该阶段是 <code>STW</code> 回收，帮助完成标记周期。G1 GC 清空 SATB 缓冲区，跟踪未被访问的存活对象，并执行引用处理。</li>
<li><strong>清理阶段：</strong>在这个最后阶段，G1 GC 执行统计和 RSet 净化的 <code>STW</code> 操作。在统计期间，G1 GC 会识别完全空闲的区域和可供进行混合垃圾回收的区域。清理阶段在将空白区域重置并返回到空闲列表时为部分并发。</li>
</ol>


<h3>内存用尽造成Full GC</h3>

<p>查找<code>to-space exhausted</code>和<code>to-space overflow</code>,表示因内存不够产生Full GC</p>

<ol>
<li>-XX:G1ReservePercent 增加预存内存量</li>
<li>-XX:InitiatingHeapOccupancyPercent 减少此值,提前启动标记周期</li>
<li>-XX:ConcGCThreads 增加并行标记线程的数目</li>
</ol>

</article>
    <hr>
    <div class="row status">
      <div class="col-md-6">
        <div class="btn-group">
          
            <a class="btn btn-default btn-sm disabled">&laquo; Prev</a>
          
            <a class="btn btn-default btn-sm" href="/archive.html">Archive</a>
          
            <a class="btn btn-default btn-sm" href="/tools/2014/03/07/tools" title="常用工具包收集">Next &raquo;</a>
          
        </div>
      </div>
      <div class="col-md-6 visible-lg visible-md">
        <div id="bdshare" class="bdshare_t bds_tools_24 get-codes-bdshare btn-group pull-right">
          <a class="bds_tsina"></a>
          <a class="bds_tqq"></a>
          <a class="bds_t163"></a>
          <a class="bds_renren"></a>
          <span class="bds_more"></span>
        </div>
      </div>
    </div>
    


  
<div id="comments">
  <div class="ds-thread" data-title="G1(Garbage First)的使用 - My Blog"></div>
</div>




  </div>

  <div class="col-md-3 visible-lg visible-md">
    <section>
      <h4>Published</h4>
      <ul>
        <li>07 March 2014</li>
      </ul>
    </section>
    
    <section>
      <h4>Categories</h4>
      <ul>
        
        


  
     
    	<li><a href="/categories.html#jvm-ref">
    		jvm <span>1</span>
    	</a></li>
    
  


      </ul>
    </section>
    
    
    <section>
      <h4>Tags</h4>
      <ul class="tag_box">
        
        


  
     
    	<li><a href="/tags.html#g1-ref">g1 <span>1</span></a></li>
     
    	<li><a href="/tags.html#gc-ref">gc <span>1</span></a></li>
    
  



      </ul>
    </section>
    

    
  </div>

</div>


    </div>

    <footer class="text-left">
        <p>&copy; 2014 <a href="/" target="_blank">bboniao</a>. with Help from <a href="http://jekyllbootstrap.com/" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a> and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a></p>
    </footer>
</div> <!-- /container -->

<div id="back-top">
    <a href="#top" title="Back Top" class="visible-lg visible-md"></a>
</div>

<script src="//libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/themes/havee/js/jquery.min.js"><\/script>')</script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/themes/havee/js/bootstrap.min.js"><\/script>')</script>
<script type="text/javascript" src="/assets/themes/havee/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<script type="text/javascript" src="/assets/themes/havee/js/webcore.js"></script>

    <!--多说js加载开始，一个页面只需要加载一次 -->
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"bboniao"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = '/assets/themes/havee/js/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script>
    <!--多说js加载结束，一个页面只需要加载一次 -->

    <!-- Baidu Button BEGIN -->
    <script type="text/javascript" id="bdshell_js"></script>
        <script>document.write(unescape('%3Cscript%20type%3D%22text/javascript%22%20id%3D%22bdshare_js%22%20data%3D%22type%3Dtools%26amp%3Buid%3D1539895%22%3E%3C/script%3E'));</script>
        <script type="text/javascript">
          var bds_config = {
            'wbUid':1194861643,
            'review':'normal',
            'snsKey':{
            }
          };
          document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
        </script>
    <!-- Baidu Button END -->




</body>
</html>

